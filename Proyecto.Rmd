---
title: "Proyecto No.1"
author: "Héctor Valle, Rodrigo Samayoa & Paul Belches"
date: "23/3/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(ggpubr)
library(dplyr)
theme_set(theme_pubr())
datos<-read.csv("importacionesVehiculosSAT.csv", stringsAsFactors = FALSE)
datos<-datos[,-c(2,3,4,11,17)]
datos<-na.omit(datos)
```

```{r}
library(stringr)
#setwd("~/Documents/Mineria/Proyecto-Mineria/")
datosIne<-read.csv("mortalidadIne2.csv", header=FALSE, stringsAsFactors=FALSE, fileEncoding="latin1")
#names(datosIne)[1] <- "hola"
names(datosIne)[1] <- "depocu"
names(datosIne)[2] <- "mupocu"	
names(datosIne)[3] <- "sexo"
names(datosIne)[4] <- "diaocu"
names(datosIne)[5] <- "anoreg"
names(datosIne)[6] <- "mesocu"
names(datosIne)[7] <- "edadif"
names(datosIne)[8] <- "ecidif"
names(datosIne)[9] <- "escodif"
names(datosIne)[10] <- "dredif"
names(datosIne)[11] <- "mredif"
names(datosIne)[12] <- "caudef"
#Only letter
datosIne <- datosIne[-1,]
datosIne$caudef <- substr(datosIne$caudef, 1, 1)
datosIne<-filter(datosIne, caudef == "V")
#Eliminate special characters
datosIne$depocu <- str_replace_all(datosIne$depocu, "[^[:alnum:]]", "")
datosIne$mupocu <- str_replace_all(datosIne$mupocu, "[^[:alnum:]]", "")
datosIne$mesocu <- str_replace_all(datosIne$mesocu, "[^[:alnum:]]", "")
datosIne$escodif <- str_replace_all(datosIne$escodif, "[^[:alnum:]]", "")
datosIne$dredif <- str_replace_all(datosIne$dredif, "[^[:alnum:]]", "")
datosIne$mredif <- str_replace_all(datosIne$mredif, "[^[:alnum:]]", "")
#datosIne$caudef > "V00"
#Eliminate (a)
datosIne$ecidif <- str_replace_all(datosIne$ecidif, "\\(a\\)", "")
#Only letter
datosIne <- datosIne[-1,]
datosIne$caudef <- substr(datosIne$caudef, 1, 1)
datosIne<-filter(datosIne, caudef == "V")
#Eliminate special characters
datosIne$depocu <- str_replace_all(datosIne$depocu, "[^[:alnum:]]", "")
datosIne$mupocu <- str_replace_all(datosIne$mupocu, "[^[:alnum:]]", "")
datosIne$mesocu <- str_replace_all(datosIne$mesocu, "[^[:alnum:]]", "")
datosIne$escodif <- str_replace_all(datosIne$escodif, "[^[:alnum:]]", "")
datosIne$dredif <- str_replace_all(datosIne$dredif, "[^[:alnum:]]", "")
datosIne$mredif <- str_replace_all(datosIne$mredif, "[^[:alnum:]]", "")
#datosIne$caudef > "V00"
#Eliminate (a)
datosIne$ecidif <- str_replace_all(datosIne$ecidif, "\\(a\\)", "")
```

### Descripción de  la situación problemática:

Los accidentes de tránsito son la segunda causa de muerte en Guatemala, por detrás de los incidentes que involucran armas de fuego. Diariamente alrededor de 17 accidentes de tránsito deja varios fallecidos según el Instituto Nacional de Ciencias Forenses. A pesar de que los incidentes han disminuido en cantidad durante el plazo 2018 - 2019, la magnitud de los accidentes y la cantidad de muertes solo ha aumentado. En comparación, el año 2019 ha excedido a su predecesor por más de 113 muertes. Las causas varían relacionando a todo tipo de vehiculos, buses de transporte extraurbano, transporte de carga y automóviles livianos. Por lo que se busca determinar el impacto de las crecientes importaciones de vehículos, en este fenómeno. 

### Problema científico y Objetivos preliminares. 

Identificar la categoría de vehículo que está involucrada en  mayor cantidad de accidentes de tránsito que  resulte en la muerte de las personas. Tomando en cuenta la proporción que representan tránsito vehicular, para determinar su impacto. 

Identificar las condiciones en que estos accidentes de tránsito ocurren en mayor consistencia.

Identificar las causas principales de de estos accidentes de tránsito.

Determinar si la categoría vehicular con mayor culpabilidad de accidentes, es la que cuenta con mayor crecimiento por importación. 

### Información a utilizar 

Para responder la problemática que se presenta, se utilizaran:

- Base de datos de la importaciones de la SAT
- Base de datos de defunciones del Ine

#### Descripcion de Variables:

##### **SAT**

**Pais de Provinencia (Cualitativa Nominal):**
País del que proviene el vehiculo

**Aduana de ingreso (Cualitativa Nominal):**
Nombre de la aduana en la que el vehiculo ingreso

**Fecha de la Poliza (Cualitativa Ordinal):**
Fecha en la que el carro es registrado

**Partida Arancelaria (Cuantitativa Discreta):**
Codigo de distincion para saber al grupo de pago de impuestos al que pertenece

**Modelo del Vehiculo (Cualitativa Ordinal):**
Modelo del vehiculo

**Marca (Cualitativa Nominal): **
Marca del vehiculo

**Linea (Cualitativa Nominal):**
Linea del vehiculo 

**Centimetros Cubicos (Cuantitativa Discreta): **
Tamaño del motor

**Distintivo (Cualitativa Nominal):**
Distintivo del vehiculo

**Tipo de Vehiculo (Cualitativa Nominal):**
Tipo de vehiculo

**Tipo de Importador (Cualitativa Nominal):**
Tipo de importador (OCASIONAL o DISTRIBUIDOR)

**Tipo Combustible (Cualitativa Nominal):**
Combustible que utiliza el vehiculo

**Asientos (Cuantitativa Discreta):**
Numero de asientos que tiene el vehiculo

**Puertas (Cuantitativa Discreta):**
Numero de puertas que tiene el vehiculo

**Tonelaje (Cuantitativa Discreta):**
Peso del vehiculo

**Valor VIF (Cuantitativa Continua):**
Costo del vehiculo despues de haber pagado impuestos

**Impuesto (Cuantitativa Continua):**
Cantidad de impuestos que se debe pagar

En el caso de la SAT, las variables que se utilizarán son País de Provinencia, Modelo del Vehículo, Marca, Línea, Centímetros Cúbicos, Distintivo, Tipo de Vehículo, Tipo de Combustible, Asientos, Puertas, Tonelaje y Valor CIF. Estas variables se eligieron debido a que luego de identificar las características de los vehículos involucrados en accidentes fatales, se evaluarían sus características en el ámbito de importaciones.

Para el dataset de importaciones de la SAT los procesos de limpieza que se realizaron fueron los siguientes: Se eliminaron todas las filas en las cuales existieran valores nulos para algunos de las columnas. Luego se buscó estandarizar los datos categóricos, asegurando que no existieron caracteres especiales en los diferentes valores. Los valores que se buscaron fueron tildes y signos de puntuación, pero estos no se encontraron ya que todas las variables con caracteres estaban en mayúsculas y sin tildes.

#### **INE**

La base de datos de defucniones del INE, busca alamcenar toda la información pertienente en relación al deceso de una persona dentro del territorio nacialonal. Registrando la mayor cantidad de datos en relación al suceso. A continuación se presenta una lista de las variables presentes dentro de este set de datos, además de el valor que representan. 

**Depocu (Cualitativa Nominal):**
Departamento de registro

**Mupocu (Cualitativa Nominal):**
Municipio de registro

**Mesreg (Cualitativa Nominal):**
Mes de registro

**Añoreg (Cualitativa Ordinal):**
Año de registro

**Depocu (Cualitativa Ordinal):**
Departamento de ocurrencia

**Mupocu (Cualitativa Nominal):**
Municipio de ocurrencia 

**Sexo (Cualitativa Nominal):**
Mes de ocurrencia

**Añoocu (Cualitativa Ordinal):**
Año de ocurrencia

**Edadif (Cualitativa Ordinal):**
Edad del difunto

**Perdif (Cualitativa Ordinal):**
Periodo de edad del difunto

**Puedif (Cualitativa Ordinal):**
Pueblo al que pretenece el difunto

**Ecidif (Cualitativa Nominal):**
Estado civil del difunto

**Escodif (Cualitativa Nominal):** 
Ecolaridad del difunto

**Ciuodif (Cualitativa Nominal):**
Ocupación del difunto

**Pnadif (Cualitativa Nominal):**
País de nacieminto del equipo

**Dnadif (Cualitativa Nominal):**
Departamento de nacimiento del difunto

**Mnadif (Cualitativa Nominal):**
Municipio del nacimiento del difunto

**Nacdif (Cualitativa Nominal):**
Nacionalidad del difunto

**Predif (Cualitativa Nominal):**
País de recidencia del difunto

**Dredif (Cualitativa Nominal):**
Departamento de recidencia del difunto

**Mredif (Cualitativa Nominal):**
Municipio de recidencia del difunto

**Caudef (Cualitativa Nominal):**
Causa de defunción

**Asist (Cualitativa Nominal):**
Asistencia recibida

**Oucr (Cualitativa Nominal):**
Sitio de ocurrencia

**Cerdef (Cualitativa Nominal):**
Quien certifica

En el caso de Ine, las variables a utilizar serán, depocu, mupocu, sexo, diaocu, añoreg, mesocu, edadif, ecidif, escodif, dredif, mredif, caudef. Esto en primer lugar, gracias a que son variables que se encuentran presentes en todos los datasets año tras año, del 2011 al 2018. Además en variables como la ocupación del difunto el valor indefinido se encuetra respetidas veces por lo que no permite la extracción de información de manera adecuada. 

### **Tablas de frecuencia de variables elegidas**

#### **SAT**

#### **Pais de Proveniencia**
```{r}
#Pais de Proveniencia
df <- datos %>%
  group_by(Pais.de.Proveniencia) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df[1:10,]
ggplot(df[1:10,], aes(x = reorder(Pais.de.Proveniencia,count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.3) + theme_pubclean()

```

Como se puede observar en la gráfica, solo se presentan 10 países, esto se debe a que la cantidad de países dentro de los datos es muy grande para poder graficarlos de tal manera que se pueda identificar los países claramente, por lo cual se eligieron los 10 países con la mayor cantidad de instancias. Se pueden observar los países con la cantidad más grande de instancias de importaciones son China, Japón y Estado Unidos.

#### **Modelo de Vehículo**
```{r}
#Modelo de Vehiculo
df <- datos %>%
  group_by(Modelo.del.Vehiculo) %>%
  summarise(count = n())
df
ggplot(df, aes(x = Modelo.del.Vehiculo, y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = ""), vjust = -0.5) + theme_pubclean()
hist(datos$Modelo.del.Vehiculo)
```

Esta gráfica presenta la distribución de el año de modelo de los vehículos, y como se puede observar, la tasa de crecimiento a lo largo de los años ha sido exponencial, de tal manera que la cantidad de importaciones año tras año ha ido incrementando, con últimos 3 años como los que tienen la mayor cantidad.

#### **Marca**
```{r}
#Marca
df <- datos %>%
  group_by(Marca) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df[1:10,], aes(x = reorder(Marca,count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

En esta gráfica se presenta la distribución de la cantidad de vehículos por marca, tomando en cuenta las 10 marcas con mayor cantidad de filas, donde curiosamente las 3 marcas con la mayor cantidad de instancias son japonesas, y como se pudo ver en el país de proveniencia, también es uno de los países que más apareció.

#### **Linea**
```{r}
#Linea
df <- datos %>%
  group_by(Linea) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df[1:10,], aes(x = reorder(Linea,count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

Como se puede observar en la gráfica, se presentan las 10 líneas de vehículo con la mayor cantidad de filas que las contienen, y como se puede observar, la que tiene la mayor cantidad es una motocicleta marca Suzuki, la cual aparece casi el doble del segundo lugar.

#### **Centimetros Cubicos**
```{r}
#Centimetros.Cubicos
df <- datos %>%
  group_by(Centimetros.Cubicos) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df[1:10,], aes(x = reorder(Centimetros.Cubicos,count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

Esta gráfica presenta el tamaño del motor del vehículo en centímetros cúbicos, y debido a la gran cantidad de datos, se presentan los 10 tamaños más comunes en el dataset, con el tamaño más común siendo de 125 centímetros cúbicos.

#### **Distintivo**
```{r}
#Distintivo
df <- datos %>%
  group_by(Distintivo) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df
ggplot(df, aes(x = reorder(Distintivo,count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

En esta gráfica se puede observar el distintivo del vehículo, en la cual las 3 posibles categorías son Liviano, Pesado y ninguno de los 2. Claramente la mayor cantidad de vehículos son clasificados como livianos.

#### **Tipo de Vehiculo**
```{r}
#Tipo de Vehiculo
df <- datos %>%
  group_by(Tipo.de.Vehiculo) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df[1:10,], aes(x = reorder(Tipo.de.Vehiculo,count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

#### **Tipo de Combustible**
```{r}
#Tipo de Combustible
df <- datos %>%
  group_by(Tipo.Combustible) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df, aes(x = reorder(Tipo.Combustible, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

Esta gráfica muestra el tipo de combustible de los vehículos importados, donde estos pueden utilizar gasolina, Diesel u otros, y se puede ver que los vehículos son principalmente de gasolina.

#### **Asientos**
```{r}
#Asientos
df <- datos %>%
  group_by(Asientos) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df[1:10,], aes(x = reorder(Asientos, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

En esta gráfica se puede observar la cantidad de asientos que tiene el vehículo, en las cuales la más común es 2, lo cual podría asumir que es una motocicleta como se vio en las gráficas anteriores, y el siguiente que es de 5, se puede suponer que es un automóvil.

#### **Puertas**
```{r}
#Puertas
df <- datos %>%
  group_by(Puertas) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df, aes(x = reorder(Puertas, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

Como se puede apreciar en esta gráfica se puede observar la cantidad de puertas que tiene el vehículo, en las cuales la más común es 0, lo cual podría asumir que es una motocicleta como se vio en las gráficas anteriores, y el siguiente que es de 4 y 2, se puede suponer que es un automóvil.

#### **Tonelaje**
```{r}
#Tonelaje
df <- datos %>%
  group_by(Tonelaje) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df[1:10,], aes(x = reorder(Tonelaje, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

En gráfica muestra el tonelaje del vehículo, en las cuales la más común es 0, lo cual podría asumir que es un vehículo que no necesariamente pese 0 toneladas, sino que menos de 1 tonelada, y el siguiente que es de 1, se puede suponer que es un vehículo más pesado pero del mismo tipo.

#### **Valor CIF**
```{r}
#Valor.CIF
df <- datos %>%
  group_by(Valor.CIF) %>%
  summarise(count = n())
df <- df[order(-df$count),]
hist(df$Valor.CIF)

```

En esta gráfica se puede observar el Valor CIF de cada vehículo, el cual es el valor real de las mercancías durante el despacho aduanero, en el cual se incluye el costo de las mercancías, el seguro y del flete hasta el puerto de destino.

#### **Año**
```{r}
df <- datos %>%
  group_by(Anio) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df, aes(x = reorder(Anio, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```
#### **Ine**


```{r}
#Departamento
df <- datosIne %>%
  group_by(depocu) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:10,]
df$n <- 1
for (i in 1:nrow(df)){
  df[i,]$n <- i
}
print(df)
ggplot(df, aes(x = reorder(n, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

La tabla de frecuencia muestra la cantidad de decesos registrados por departamento ordenados de froma decendiente, para los 10 deparatamentos con mayor cantidad de decesos. Como se puede observar Escuintla cuenta con el mayor número de decesos, seguido por Guatemala. Como se puede ver en los histogramas , la diferencia entre los primeros dos departamentos y los demás es evidente. Para la cantia posición la cantidad de decesos se redujo a la mitad. 


```{r}
#Municipio
df <- datosIne %>%
  group_by(mupocu) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:20,]
df$n <- 1
for (i in 1:nrow(df)){
  df[i,]$n <- i
}
print(df)
ggplot(df, aes(x = reorder(n, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

La siguiente tabla de frecuencia muestra la cantidad de decesos registrados por municipio ordenados de froma decendiente, para los 10 municipios con mayor cantidad de decesos. Como se puede observar Guatemala cuenta con el mayor número de decesos, seguido por Escuintla. En relación a la gráfica anterior , resalta como es que la posición de los departamentos represetnados cambia en orden.  De una misma manera es evidente el decenso exponencial que existe, al moverse de los primeros municipios , a las posiciones medias de la tabla.  

```{r}
#Sexo
df <- datosIne %>%
  group_by(sexo) %>%
  summarise(count = n())
df <- df[order(-df$count),]
print(df)
ggplot(df, aes(x = reorder(sexo, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

La tabla de frecuencia muestra la cantidad de decesos registrados por sexo. Como se puede ver en los histogramas , la diferencia entre la cantidad de honbres y mujeres es considerable en consideración. La cantidad de hombres es casi 4 veces más que las mujeres.  


```{r}
#Día de ocurrencia
df <- datosIne %>%
  group_by(diaocu) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:10,]
print(df)
ggplot(df, aes(x = reorder(diaocu, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

La siguiente tabla de frecuencia muestra la cantidad de decesos registrados por día del mes de froma decendiente, para los 10 días con mayor cantidad de decesos. Como se puede observar la quincena y el principio de mes, son los días que se presenta una mayor cantidad de decesos. Probablemente relacionado con que ambos días son días de pago. Sin embargo la cantidad no deciende mucho en relación a los demás días como se puede ver en el histograma. 

```{r}
#Año de registro
df <- datosIne %>%
  group_by(anoreg) %>%
  summarise(count = n())
df <- df[order(-df$count),]
print(df)
ggplot(df, aes(x = reorder(anoreg, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

La siguiente tabla de frecuencia muestra la cantidad de decesos registrados por año de froma decendiente, para el periodo 2016-2019. Como se puede observar en los histogramas, existe un crecimiento exponencial del año 2017 al 2018. Por lo que se supone que en 2018 existio un mejor registro, en relación a los demás años.  Además los años 2016 y 2019, cuentan con valores extremadamente bajos, lo que se puede deber a un mal registro. 


```{r}
#Mes de ocurrencia
df <- datosIne %>%
  group_by(mesocu) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:9,]
print(df)
ggplot(df, aes(x = reorder(mesocu, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

La siguiente tabla de frecuencia muestra la cantidad de decesos registrados por mes de froma decendiente, para los 9 meses con mayor cantidad de decesos registrados. Como se puede observar diciembre es el mes que cuenta con una mayor cantidad de muertes. Probablemente relacionado con la coincidencia con el preiodo de vacciones. Sin embargo la cantidad no varía mucho entre los meses restantes. 


```{r}
#Edad de difuntos 
df <- datosIne %>%
  group_by(edadif) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:10,]
print(df)
ggplot(df, aes(x = reorder(edadif, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

La siguiente tabla de frecuencia muestra la cantidad de decesos registrados por edad. Como se puede observar el rango se maneja de 19 a 28 años. Sin existir una gran diferencia. Sin embargo, tomando en cuenta que la mayoría de los primeros valores, pertencen a la primera mitad del rango. Podríamos afirmar que a medida que la edad aumenta los decesos relacionados con incidentes vehiculares deciende. 


```{r}
#Estado civil
df <- datosIne %>%
  group_by(ecidif) %>%
  summarise(count = n())
df <- df[order(-df$count),]
print(df)
ggplot(df, aes(x = reorder(ecidif, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

La siguiente tabla de frecuencia muestra la cantidad de decesos registrados agrupados por el estado civil del difunto. Como se puede observar es evidente que los solteros , son la gran mayoria. Tomando en cuenta la tabla anterior, que la mayoria de decesos este relacionada con gente jóven, puede dar razón al por qué de esta distribución. Sin embargo también puede estar relacionado a la tasa de matriomonios del país, aunque esto no forma parte del enfoque del estudio. 

```{r}
#Escolaridad del difunto
df <- datosIne %>%
  group_by(escodif) %>%
  summarise(count = n())
df <- df[order(-df$count),]
print(df)
ggplot(df, aes(x = reorder(escodif, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

La siguiente tabla de frecuencia muestra la cantidad de decesos registrados agrupados por la escolaridad del difunto. Los grupos con menor educación cuentan con las primeras posiciones de la tabla. A pesar de que el grupo Primaria sobrepasa al no que no estudio, esto puede estar relacionado con el mayor acceso que se puede llegar a tener a vehiculos. Además manteniendo la misma linea de pensamiento, se puede observar como es que tanto los grados universitarios como Postgrado, representan el fondo de la tabla. 

```{r}
#Departamwnto de residencia del difunto
df <- datosIne %>%
  group_by(dredif) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:10,]
df$n <- 1
for (i in 1:nrow(df)){
  df[i,]$n <- i
}
print(df)
ggplot(df, aes(x = reorder(n, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

La tabla de frecuencia muestra la cantidad de decesos registrados por departamento de recidencia ordenados de froma decendiente, para los 10 deparatamentos de recidencia con mayor cantidad de decesos. Como se puede observar Guatemala cuenta con el mayor número de decesos, seguido por Escuintla, concordando con lsa tablas del inicio. Sin embargo la diferencia es considerable en comparción. 

```{r}
#Municipio de residencia del difunto
df <- datosIne %>%
  group_by(mredif) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:10,]
df$n <- 1
for (i in 1:nrow(df)){
  df[i,]$n <- i
}
print(df)
ggplot(df, aes(x = reorder(n, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```


La tabla de frecuencia muestra la cantidad de decesos registrados por departamento de recidencia ordenados de froma decendiente, para los 10 deparatamentos de recidencia con mayor cantidad de decesos. Como se puede observar Guatemala cuenta con el mayor número de decesos, seguido por Escuintla, concordando con lsa tablas del inicio. Sin embargo la diferencia es considerable en comparción. 

Con el objetivo de la realización de los clústeres, se convirtieron todos los factores categoricos en factores categoricos npumericos. De esta manera es posible la agrupación por parte de los algoritmos. 

```{r}
#Convert categorical dataset into numerical categorical
datosIneN <- datosIne
datosIneN$depocu <- as.numeric(factor(datosIne$depocu))
datosIneN$mupocu <- as.numeric(factor(datosIne$mupocu))
datosIneN$sexo <- as.numeric(factor(datosIne$sexo))
datosIneN$diaocu <- as.numeric(factor(datosIne$diaocu))
datosIneN$anoreg <- as.numeric(factor(datosIne$anoreg))
datosIneN$mesocu <- as.numeric(factor(datosIne$mesocu))
datosIneN$edadif <- as.numeric(factor(datosIne$edadif))
datosIneN$ecidif <- as.numeric(factor(datosIne$ecidif))
datosIneN$escodif <- as.numeric(factor(datosIne$escodif))
datosIneN$dredif <- as.numeric(factor(datosIne$dredif))
datosIneN$mredif <- as.numeric(factor(datosIne$mredif))
datosIneN$caudef <- as.numeric(factor(datosIne$caudef))
```

A continuación se presentan las correlaciones que existen entre los diferentes datos:

```{r}
library(corrplot)
matriz_cor <- cor(datosIneN[-12])
matriz_cor
 corrplot(matriz_cor)
```

Como se puede observar, con excepción del departamento de registro de la defunción y el departamento de ocurrencia, las variables son independientes entre sí. Es evidente la razón de la existencia de la  relación depocu y dredif, sin embargo es interesante observar como no es uno.Lo que significa que exite un porcentaje considerable de decesos que se registran en departamentos diferentes. 

Se realiza una grafica de codo para determinar el número de grupos para la realización de los clústeres. 

```{r}
wss <- (nrow(datosIneN[-12])-1)*sum(apply(datosIneN[-12],2,var))

for (i in 2:10) 
  wss[i] <- sum(kmeans(datosIneN[-12], centers=i)$withinss)


plot(1:10, wss, type="b", xlab="Number of Clusters",  ylab="Within groups sum of squares")
```

Dos es el número indicado. 

#=======
Para poder llevar a cabo un mejor análisis de las variables categóricas del dataset de importaciones de la SAT, se le asignaron valores numéricos a cada instancia única de las variables, para así poder utilizar varias herramientas de análisis como histogramas, mapas de calor, matrices de correlación y otras.
```{r}
#Convert categorical dataset into numerical categorical
datosSAT<-datos
datosSAT$Pais.de.Proveniencia <- as.numeric(factor(datosSAT$Pais.de.Proveniencia))
datosSAT$Modelo.del.Vehiculo <- as.numeric(factor(datosSAT$Modelo.del.Vehiculo))
datosSAT$Marca <- as.numeric(factor(datosSAT$Marca))
datosSAT$Linea <- as.numeric(factor(datosSAT$Linea))
datosSAT$Distintivo <- as.numeric(factor(datosSAT$Distintivo))
datosSAT$Tipo.de.Vehiculo <- as.numeric(factor(datosSAT$Tipo.de.Vehiculo))
datosSAT$Tipo.Combustible <- as.numeric(factor(datosSAT$Tipo.Combustible))
```
#### **Clusters SAT**
```{r}
library(factoextra)
library(cluster)
library(corrplot)
library(fpc)
corel <- cor(datosSAT)
corel
corrplot(corel)

wcss <- vector()
for(i in 1:10){
  wcss[i] <- sum(kmeans(datosSAT, i)$withinss)
}

ggplot() + geom_point(aes(x = 1:10, y = wcss), color = 'blue') + 
  geom_line(aes(x = 1:10, y = wcss), color = 'blue') + 
  ggtitle("Método del Codo") + 
  xlab('Cantidad de Centroides k') + 
  ylab('WCSS')
```
Debido a que la cantidad de datos que se encuentra en el dataset de importaciones de la SAT es más de 2 millones de filas con 16 columnas, varios de los métodos de análisis que se implementaron no podían soportar un manejo de datos tan grande por lo cual se tuvo que crear samples del dataset del tamaño más grande que fuera posible para el método. Específicamente para la prueba de la silueta, no se pudo evaluar sobre todos los datos, pero como se puede observar sobre el sample que se obtuvo, el resultado fue consistentemente alrededor de 0.80 por lo cual la clasificación por clustering elegida con K-means fue aceptable definiendo 2 centroides de acuerdo a la gráfica de codo. 

```{r} 
k <- kmeans(datosSAT, centers = 2)
p <- fviz_cluster(k, geom = "point", data = datosSAT)+ ggtitle("k = 2")
p
datosSAT$kgroup <- k$cluster
plotcluster(datosSAT[,-c(17)],k$cluster)
sam<-sample(1:nrow(datosSAT),20000)
silkm<-silhouette(datosSAT[sam,"kgroup"],dist(datosSAT[sam,1:16]))
mean(silkm[,3])
```


```{r} 
library(e1071)#para cmeans
library(cluster) #Para calcular la silueta
datosSample <- sample(1:nrow(datosSAT), 10000)
#cmeans
fcm<-cmeans(datosSAT,2)
datosSAT$FCGrupos<-fcm$cluster
#silueta
silfcm<-silhouette(datosSAT[datosSample,"FCGrupos"],dist(datosSAT[datosSample,1:16]))
mean(silfcm[,3])
```
#### **Clusters INE**

Se inicia con un clúster con el algoritmo de Kmeans.
```{r} 
#Cluster Kmeans
library(cluster) #Para calcular la silueta
library(fpc)
km<-kmeans(datosIneN[-12],2)
plotcluster(datosIneN[-12],km$cluster)

#Método de la silueta para las k-medias
silkm<-silhouette(km$cluster,dist(datosIneN[-12]))
mean(silkm[,3]) #0.55, no es la mejor partición pero no está mal
```

Kmodes es una variación del algoritmo especifica para variables categoricas, por lo que se realiza esperando un mejor valor de silueta. 

```{r}
#Cluster Kmodes
library(klaR)
kmo<-kmodes(datosIneN[-12], 2, iter.max = 10, weighted = FALSE)
#kmo
plotcluster(datosIneN[-12],kmo$cluster)

#Método de la silueta para las k-medias
silkm<-silhouette(kmo$cluster,dist(datosIneN[-12]))
mean(silkm[,3]) #0.55, no es la mejor partición pero no está mal
```

Al no mejorar se trabaj sobre Kmeans. Se grafican las variables para hacerse una idea de la manera en que están distribuidas respecto a las demás

```{r}
plotp1 <- datosIneN[-12]
plotp2 <- plotp1[6:11] 
plotp1 <- plotp1[1:6]
plot(plotp1)
plot(plotp2)

```

Se seleccionan mupocu, sexo, diaocu, mesocu, ecidif y dredif, gracias a que se optiene un mejor valor de silueta.

```{r}
#datosIneN
dc <-  datosIneN[c(2,3,4,6,8,10)]
km<-kmeans(dc,2)
plotcluster(dc,km$cluster)
silkm<-silhouette(km$cluster,dist(dc))
mean(silkm[,3]) 
```

Se prueba Cmeans para ver si mejora la silueta. 

```{r}
#datosIneN
library(e1071)
dc <-  datosIneN[c(2,3,4,6,8,10)]
cm<-cmeans(dc,2)
plotcluster(dc,cm$cluster)
silkm<-silhouette(cm$cluster,dist(dc))
mean(silkm[,3]) 
```

Se cuenta con mejor un mejor agrupamiento. Además se prueba con mixture of gaussians.

```{r}
#datosIneN
library(mclust)
dc <-  datosIneN[c(3,5,6,11)]
mc<-Mclust(dc,2)
plot(mc, what = "classification", main="MClust Classification")
silmg<-silhouette(mc$classification,dist(dc))
mean(silmg[,3])
```

Se prueba con clustering jerárquico.

```{r}
#datosIneN
library(mclust)
dc <-  datosIneN[c(3,5,6,11)]
hc<-hclust(dist(dc))
plot(hc)
rect.hclust(hc,k=2)
groups<-cutree(hc,k=2)
silch<-silhouette(groups,dist(dc))
mean(silch[,3])

```

Por ser el mejor agrupamiento, este es el clúster seleccionado. 

