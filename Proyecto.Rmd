---
title: "Proyecto No.1"
author: "Héctor Valle, Rodrigo Samayoa & Paul Belches"
date: "23/3/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(ggpubr)
library(dplyr)
theme_set(theme_pubr())
datos<-read.csv("importacionesVehiculosSAT.csv", stringsAsFactors = FALSE)
datos<-datos[,-c(2,3,4,11,17)]
datos<-na.omit(datos)
```

```{r setup, include=FALSE}
library(ggplot2)
library(dplyr)
setwd("~/Documents/Mineria/Proyecto-Mineria/")
datosIne<-read.csv("mortalidadIne2.csv", header=FALSE, stringsAsFactors=FALSE, fileEncoding="latin1")
```

```{r setup, include=FALSE}
#names(datosIne)[1] <- "hola"
names(datosIne)[1] <- "depocu"
names(datosIne)[2] <- "mupocu"	
names(datosIne)[3] <- "sexo"
names(datosIne)[4] <- "diaocu"
names(datosIne)[5] <- "anoreg"
names(datosIne)[6] <- "mesocu"
names(datosIne)[7] <- "edadif"
names(datosIne)[8] <- "ecidif"
names(datosIne)[9] <- "escodif"
names(datosIne)[10] <- "dredif"
names(datosIne)[11] <- "mredif"
names(datosIne)[12] <- "caudef"
```


```{r}
#Only letter
datosIne <- datosIne[-1,]
datosIne$caudef <- substr(datosIne$caudef, 1, 1)
datosIne<-filter(datosIne, caudef == "V")
```


```{r}
#Eliminate special characters
datosIne$depocu <- str_replace_all(datosIne$depocu, "[^[:alnum:]]", "")
datosIne$mupocu <- str_replace_all(datosIne$mupocu, "[^[:alnum:]]", "")
datosIne$mesocu <- str_replace_all(datosIne$mesocu, "[^[:alnum:]]", "")
datosIne$escodif <- str_replace_all(datosIne$escodif, "[^[:alnum:]]", "")
datosIne$dredif <- str_replace_all(datosIne$dredif, "[^[:alnum:]]", "")
datosIne$mredif <- str_replace_all(datosIne$mredif, "[^[:alnum:]]", "")
#datosIne$caudef > "V00"
```

```{r}
#Eliminate (a)
datosIne$ecidif <- str_replace_all(datosIne$ecidif, "\\(a\\)", "")
```

```{r}
datosIne
```


### Descripción de  la situación problemática:

Los accidentes de tránsito son la segunda causa de muerte en Guatemala, por detrás de los incidentes que involucran armas de fuego. Diariamente alrededor de 17 accidentes de tránsito deja varios fallecidos según el Instituto Nacional de Ciencias Forenses. A pesar de que los incidentes han disminuido en cantidad durante el plazo 2018 - 2019, la magnitud de los accidentes y la cantidad de muertes solo ha aumentado. En comparación, el año 2019 ha excedido a su predecesor por más de 113 muertes. Las causas varían relacionando a todo tipo de vehiculos, buses de transporte extraurbano, transporte de carga y automóviles livianos. Por lo que se busca determinar el impacto de las crecientes importaciones de vehículos, en este fenómeno. 

### Problema científico y Objetivos preliminares. 

Identificar la categoría de vehículo que está involucrada en  mayor cantidad de accidentes de tránsito que  resulte en la muerte de las personas. Tomando en cuenta la proporción que representan tránsito vehicular, para determinar su impacto. 

Identificar las condiciones en que estos accidentes de tránsito ocurren en mayor consistencia.

Identificar las causas principales de de estos accidentes de tránsito.

Determinar si la categoría vehicular con mayor culpabilidad de accidentes, es la que cuenta con mayor crecimiento por importación. 

### Información a utilizar 

Para responder la problemática que se presenta, se utilizaran:

- Base de datos de la importaciones de la SAT
- Base de datos de defunciones del Ine

#### Descripcion de Variables:

##### **SAT**

**Pais de Provinencia (Cualitativa Nominal):**
País del que proviene el vehiculo

**Aduana de ingreso (Cualitativa Nominal):**
Nombre de la aduana en la que el vehiculo ingreso

**Fecha de la Poliza (Cualitativa Ordinal):**
Fecha en la que el carro es registrado

**Partida Arancelaria (Cuantitativa Discreta):**
Codigo de distincion para saber al grupo de pago de impuestos al que pertenece

**Modelo del Vehiculo (Cualitativa Ordinal):**
Modelo del vehiculo

**Marca (Cualitativa Nominal): **
Marca del vehiculo

**Linea (Cualitativa Nominal):**
Linea del vehiculo 

**Centimetros Cubicos (Cuantitativa Discreta): **
Tamaño del motor

**Distintivo (Cualitativa Nominal):**
Distintivo del vehiculo

**Tipo de Vehiculo (Cualitativa Nominal):**
Tipo de vehiculo

**Tipo de Importador (Cualitativa Nominal):**
Tipo de importador (OCASIONAL o DISTRIBUIDOR)

**Tipo Combustible (Cualitativa Nominal):**
Combustible que utiliza el vehiculo

**Asientos (Cuantitativa Discreta):**
Numero de asientos que tiene el vehiculo

**Puertas (Cuantitativa Discreta):**
Numero de puertas que tiene el vehiculo

**Tonelaje (Cuantitativa Discreta):**
Peso del vehiculo

**Valor VIF (Cuantitativa Continua):**
Costo del vehiculo despues de haber pagado impuestos

**Impuesto (Cuantitativa Continua):**
Cantidad de impuestos que se debe pagar

En el caso de la SAT, las variables que se utilizarán son País de Provinencia, Modelo del Vehículo, Marca, Línea, Centímetros Cúbicos, Distintivo, Tipo de Vehículo, Tipo de Combustible, Asientos, Puertas, Tonelaje y Valor CIF. Estas variables se eligieron debido a que luego de identificar las características de los vehículos involucrados en accidentes fatales, se evaluarían sus características en el ámbito de importaciones.

#### **INE**

La base de datos de defucniones del INE, busca alamcenar toda la información pertienente en relación al deceso de una persona dentro del territorio nacialonal. Registrando la mayor cantidad de datos en relación al suceso. A continuación se presenta una lista de las variables presentes dentro de este set de datos, además de el valor que representan. 

**Depocu (Cualitativa Nominal):**
Departamento de registro

**Mupocu (Cualitativa Nominal):**
Municipio de registro

**Mesreg (Cualitativa Nominal):**
Mes de registro

**Añoreg (Cualitativa Ordinal):**
Año de registro

**Depocu (Cualitativa Ordinal):**
Departamento de ocurrencia

**Mupocu (Cualitativa Nominal):**
Municipio de ocurrencia 

**Sexo (Cualitativa Nominal):**
Mes de ocurrencia

**Añoocu (Cualitativa Ordinal):**
Año de ocurrencia

**Edadif (Cualitativa Ordinal):**
Edad del difunto

**Perdif (Cualitativa Ordinal):**
Periodo de edad del difunto

**Puedif (Cualitativa Ordinal):**
Pueblo al que pretenece el difunto

**Ecidif (Cualitativa Nominal):**
Estado civil del difunto

**Escodif (Cualitativa Nominal):** 
Ecolaridad del difunto

**Ciuodif (Cualitativa Nominal):**
Ocupación del difunto

**Pnadif (Cualitativa Nominal):**
País de nacieminto del equipo

**Dnadif (Cualitativa Nominal):**
Departamento de nacimiento del difunto

**Mnadif (Cualitativa Nominal):**
Municipio del nacimiento del difunto

**Nacdif (Cualitativa Nominal):**
Nacionalidad del difunto

**Predif (Cualitativa Nominal):**
País de recidencia del difunto

**Dredif (Cualitativa Nominal):**
Departamento de recidencia del difunto

**Mredif (Cualitativa Nominal):**
Municipio de recidencia del difunto

**Caudef (Cualitativa Nominal):**
Causa de defunción

**Asist (Cualitativa Nominal):**
Asistencia recibida

**Oucr (Cualitativa Nominal):**
Sitio de ocurrencia

**Cerdef (Cualitativa Nominal):**
Quien certifica

En el caso de Ine, las variables a utilizar serán, depocu, mupocu, sexo, diaocu, añoreg, mesocu, edadif, ecidif, escodif, dredif, mredif, caudef. Esto en primer lugar, gracias a que son variables que se encuentran presentes en todos los datasets año tras año, del 2011 al 2018. Además en variables como la ocupación del difunto el valor indefinido se encuetra respetidas veces por lo que no permite la extracción de información de manera adecuada. 

### **Tablas de frecuencia de variables elegidas**

#### **SAT**

#### **Pais de Proveniencia**
```{r}
#Pais de Proveniencia
df <- datos %>%
  group_by(Pais.de.Proveniencia) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df[1:10,]
ggplot(df[1:10,], aes(x = reorder(Pais.de.Proveniencia,count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.3) + theme_pubclean()

```

#### **Modelo de Vehículo**
```{r}
#Modelo de Vehiculo
df <- datos %>%
  group_by(Modelo.del.Vehiculo) %>%
  summarise(count = n())
df
ggplot(df, aes(x = Modelo.del.Vehiculo, y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = ""), vjust = -0.5) + theme_pubclean()
hist(datos$Modelo.del.Vehiculo)
```

#### **Marca**
```{r}
#Marca
df <- datos %>%
  group_by(Marca) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df[1:10,], aes(x = reorder(Marca,count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

#### **Linea**
```{r}
#Linea
df <- datos %>%
  group_by(Linea) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df[1:10,], aes(x = reorder(Linea,count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

#### **Centimetros Cubicos**
```{r}
#Centimetros.Cubicos
df <- datos %>%
  group_by(Centimetros.Cubicos) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df[1:10,], aes(x = reorder(Centimetros.Cubicos,count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

#### **Distintivo**
```{r}
#Distintivo
df <- datos %>%
  group_by(Distintivo) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df
ggplot(df, aes(x = reorder(Distintivo,count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

#### **Tipo de Vehiculo**
```{r}
#Tipo de Vehiculo
df <- datos %>%
  group_by(Tipo.de.Vehiculo) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df[1:10,], aes(x = reorder(Tipo.de.Vehiculo,count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

#### **Tipo de Combustible**
```{r}
#Tipo de Combustible
df <- datos %>%
  group_by(Tipo.Combustible) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df, aes(x = reorder(Tipo.Combustible, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

#### **Asientos**
```{r}
#Asientos
df <- datos %>%
  group_by(Asientos) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df[1:10,], aes(x = reorder(Asientos, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

#### **Puertas**
```{r}
#Puertas
df <- datos %>%
  group_by(Puertas) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df, aes(x = reorder(Puertas, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

#### **Tonelaje**
```{r}
#Tonelaje
df <- datos %>%
  group_by(Tonelaje) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df[1:10,], aes(x = reorder(Tonelaje, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

#### **Valor CIF**
```{r}
#Valor.CIF
df <- datos %>%
  group_by(Valor.CIF) %>%
  summarise(count = n())
df <- df[order(-df$count),]
hist(df$Valor.CIF)

```

#### **Año**
```{r}
df <- datos %>%
  group_by(Anio) %>%
  summarise(count = n())
df <- df[order(-df$count),]
ggplot(df, aes(x = reorder(Anio, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```
#### **Ine**

```{r}
datosIne 
```

```{r}
#Departamento
df <- datosIne %>%
  group_by(depocu) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:10,]
df$n <- 1
for (i in 1:nrow(df)){
  df[i,]$n <- i
}
print(df)
ggplot(df, aes(x = reorder(n, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

```{r}
#Municipio
df <- datosIne %>%
  group_by(mupocu) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:20,]
df$n <- 1
for (i in 1:nrow(df)){
  df[i,]$n <- i
}
print(df)
ggplot(df, aes(x = reorder(n, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```


```{r}
#Sexo
df <- datosIne %>%
  group_by(sexo) %>%
  summarise(count = n())
df <- df[order(-df$count),]
print(df)
ggplot(df, aes(x = reorder(sexo, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

```{r}
#Día de ocurrencia
df <- datosIne %>%
  group_by(diaocu) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:10,]
print(df)
ggplot(df, aes(x = reorder(diaocu, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

```{r}
#Año de registro
df <- datosIne %>%
  group_by(anoreg) %>%
  summarise(count = n())
df <- df[order(-df$count),]
print(df)
ggplot(df, aes(x = reorder(anoreg, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

```{r}
#Mes de ocurrencia
df <- datosIne %>%
  group_by(mesocu) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:10,]
print(df)
ggplot(df, aes(x = reorder(mesocu, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

```{r}
#Edad de difuntos 
df <- datosIne %>%
  group_by(edadif) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:10,]
print(df)
ggplot(df, aes(x = reorder(edadif, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

```{r}
#Estado civil
df <- datosIne %>%
  group_by(ecidif) %>%
  summarise(count = n())
df <- df[order(-df$count),]
print(df)
ggplot(df, aes(x = reorder(ecidif, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

```{r}
#Escolaridad del difunto
df <- datosIne %>%
  group_by(escodif) %>%
  summarise(count = n())
df <- df[order(-df$count),]
print(df)
ggplot(df, aes(x = reorder(escodif, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()

```

```{r}
#Departamwnto de residencia del difunto
df <- datosIne %>%
  group_by(dredif) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:10,]
df$n <- 1
for (i in 1:nrow(df)){
  df[i,]$n <- i
}
print(df)
ggplot(df, aes(x = reorder(n, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```

```{r}
#Municipio de residencia del difunto
df <- datosIne %>%
  group_by(mredif) %>%
  summarise(count = n())
df <- df[order(-df$count),]
df <- df[1:10,]
df$n <- 1
for (i in 1:nrow(df)){
  df[i,]$n <- i
}
print(df)
ggplot(df, aes(x = reorder(n, count), y = count)) + geom_bar(fill = "blue", stat = "identity") + geom_text(aes(label = count), vjust = -0.5) + theme_pubclean()
```











