---
title: "Proyecto No.1"
author: "Héctor Valle, Rodrigo Samayoa & Paul Belches"
date: "23/3/2020"
output:
  html_document: default
  pdf_document: default
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(ggplot2)
library(ggpubr)
library(dplyr)
theme_set(theme_pubr())
datos<-read.csv("INE-Accidentes-Guatemala.csv", stringsAsFactors = FALSE)
datos<-na.omit(datos)
datos <- datos[which(datos$depto_ocu == "Guatemala"), ]
```

```{r}
datos$mes <- 0
datos[which(datos$mes_ocu == "Enero"), ]$mes <- 1
datos[which(datos$mes_ocu == "Febrero"), ]$mes <- 2
datos[which(datos$mes_ocu == "Marzo"), ]$mes <- 3
datos[which(datos$mes_ocu == "Abril"), ]$mes <- 4
datos[which(datos$mes_ocu == "Mayo"), ]$mes <- 5
datos[which(datos$mes_ocu == "Junio"), ]$mes <- 6
datos[which(datos$mes_ocu == "Julio"), ]$mes <- 7
datos[which(datos$mes_ocu == "Agosto"), ]$mes <- 8
datos[which(datos$mes_ocu == "Septiembre"), ]$mes <- 9
datos[which(datos$mes_ocu == "Octubre"), ]$mes <- 10
datos[which(datos$mes_ocu == "Noviembre"), ]$mes <- 11
datos[which(datos$mes_ocu == "Diciembre"), ]$mes <- 12
datos
```

```{r}
#Limpieza de Datos de Insivumeh
library(readxl)

datosInsi <- read_xlsx("Insivumeh.xlsx")
datosInsi<-datosInsi[,-c(8, 9, 10, 11, 13, 14, 17)]
names(datosInsi)[1] <- "year"
names(datosInsi)[2] <- "mes"	
names(datosInsi)[3] <- "dia_ocu"
names(datosInsi)[4] <- "tempMax"
names(datosInsi)[5] <- "tempMin"
names(datosInsi)[6] <- "tempMed"
names(datosInsi)[7] <- "lluviaMed"
names(datosInsi)[8] <- "nuboMedia"
names(datosInsi)[9] <- "humeRelMedia"
names(datosInsi)[10] <- "presionAtmMedia"
```

#Data correction
```{r}
datosInsi$tempMax[is.na(datosInsi$tempMax)] <-25.66
```

#Data correction
```{r}
datosInsi$tempMin[is.na(datosInsi$tempMin)] <-15.56
```
#Data correction
```{r}
datosInsi$tempMed[is.na(datosInsi$tempMed)] <- 19.97
```
#Data correction
```{r}
datosInsi$lluviaMed[is.na(datosInsi$lluviaMed)] <-3.49
```

#Data correction
```{r}
datosInsi$nuboMedia[is.na(datosInsi$nuboMedia)] <-5.667
```

#Data correction
```{r}
datosInsi$humeRelMedia[is.na(datosInsi$humeRelMedia)] <-75.6
```

#Data correction
```{r}
datosInsi$presionAtmMedia[is.na(datosInsi$presionAtmMedia)] <-640.7
```

```{r}
datosInsi
```


```{r}
dataMezclada <- merge(x = datos, y = datosInsi, by = c("mes","year","dia_ocu"))
dataMezclada<-dataMezclada[,-c(9)]
dataMezcladaPrueba <- dataMezclada
dataMezclada
```

```{r}
#Convertir variables categoritas a numericas categoricas
dataMezclada$mes_ocu <- as.numeric(factor(dataMezclada$mes_ocu))
dataMezclada$dia_sem_ocu <- as.numeric(factor(dataMezclada$dia_sem_ocu))
dataMezclada$dia_sem_ocu <- as.numeric(factor(dataMezclada$dia_sem_ocu))
dataMezclada$depto_ocu <- as.numeric(factor(dataMezclada$depto_ocu))
dataMezclada$mupio_ocu <- as.numeric(factor(dataMezclada$mupio_ocu))
dataMezclada$sexo_fall_les <- as.numeric(factor(dataMezclada$sexo_fall_les))
dataMezclada$tipo_vehi <- as.numeric(factor(dataMezclada$tipo_vehi))
dataMezclada$color_vehi <- as.numeric(factor(dataMezclada$color_vehi))
dataMezclada$causa_acc <- as.numeric(factor(dataMezclada$causa_acc))
dataMezclada$estado_implicado <- as.numeric(factor(dataMezclada$estado_implicado))

dataMezclada[2:3] <- lapply(dataMezclada[2:3], as.numeric)
dataMezclada[6] <- lapply(dataMezclada[6], as.numeric)
dataMezclada[10] <- lapply(dataMezclada[10], as.numeric)
dataMezclada
```


```{r}
library(corrplot)
matriz_cor <- cor(dataMezclada)
corrplot(matriz_cor)
```

```{r}
#dataMezcladaPrueba
#dataMezcladaPrueba$dia_sem_ocu

#contrasts(dataMezcladaPrueba$mes)
#datos <- cbind(datos, dummy(datos$grupo, verbose = T))
```


```{r}
dataMezclada <- dataMezclada[,-c(15,16)]
dataMezclada
```

```{r}
porciento <- 70/100
set.seed(123)

trainRowsNumber<-sample(1:nrow(dataMezclada),porciento*nrow(dataMezclada))
train<-dataMezclada[trainRowsNumber,]
test<-dataMezclada[-trainRowsNumber,]
```

```{r}
train
```

```{r}
test
```


```{r}
train<-na.omit(train)
test<-na.omit(test)
```

#Redes

#Random Forest

```{r}
library(randomForest)
library(rpart)
library(caret)
library(tree)
modeloRF1<-randomForest(train$estado_implicado~.,data=train)
prediccionRF1<-predict(modeloRF1,newdata = test)
testCompleto<-test
testCompleto$predRF<-round(prediccionRF1)
```

```{r}
cfmRandomForest <- confusionMatrix(table(testCompleto$predRF, testCompleto$estado_implicado))
cfmRandomForest
```

```{r}
test
```

```{r}
train
```


## Regresión Logística

```{r}
porciento <- 70/100
set.seed(123)
dataMezclada2 <- dataMezclada
dataMezclada2$uno <- 0
dataMezclada2$dos <- 0
dataMezclada2[which(dataMezclada2$estado_implicado == 1), ]$uno <- 1
dataMezclada2[which(dataMezclada2$estado_implicado == 2), ]$dos <- 1
dataMezclada2
#dataMezclada2 <- cbind(dataMezclada2,dummy(dataMezclada2$estado_implicado,verbose = T))

#trainRowsNumber<-sample(1:nrow(dataMezclada),porciento*nrow(dataMezclada))
#train<-dataMezclada[trainRowsNumber,]
#test<-dataMezclada[-trainRowsNumber,]
```

```{r}
porciento <- 70/100
set.seed(123)

trainRowsNumber<-sample(1:nrow(dataMezclada2),porciento*nrow(dataMezclada2))
train<-dataMezclada2[trainRowsNumber,]
test<-dataMezclada2[-trainRowsNumber,]
```

```{r}
modeloRL<-glm(dos~., data = train[,c(1:19, 21)],family = binomial(link='logit'), maxit=100)
pred<-predict(modeloRL,newdata = test[,c(1:19)], type = "response")
prediccion<-ifelse(pred>=0.5,1,0)
prediccion
#confusionMatrix(test$uno,prediccion)
```


#Naive Bayes

```{r}
porciento <- 70/100
set.seed(123)
dataMezclada2 <- dataMezclada
dataMezclada2$uno <- 0
dataMezclada2$dos <- 0
dataMezclada2[which(dataMezclada2$estado_implicado == 1), ]$uno <- 1
dataMezclada2[which(dataMezclada2$estado_implicado == 2), ]$dos <- 1
dataMezclada2
#dataMezclada2 <- cbind(dataMezclada2,dummy(dataMezclada2$estado_implicado,verbose = T))

#trainRowsNumber<-sample(1:nrow(dataMezclada),porciento*nrow(dataMezclada))
#train<-dataMezclada[trainRowsNumber,]
#test<-dataMezclada[-trainRowsNumber,]
```

```{r}

```


```{r}
porciento <- 70/100
set.seed(123)

trainRowsNumber<-sample(1:nrow(dataMezclada2),porciento*nrow(dataMezclada2))
train<-dataMezclada2[trainRowsNumber,]
test<-dataMezclada2[-trainRowsNumber,]
```

```{r}
modeloNb<-naiveBayes(train$dos~.,data=train[,c(1:14, 15:19, 21)])
predBayes<-predict(modeloNb, newdata = test[,c(1:14, 15:19)])
predBayes
#confusionMatrix(table(predBayes, test$estado_implicado ))
```


